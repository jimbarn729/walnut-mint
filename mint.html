<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ú Mint Walnut Emotions</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: linear-gradient(135deg, #2b1e0f 0%, #4a3620 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            padding: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 0 2px #8b5a2b inset;
            padding: 30px;
            max-width: 480px;
            width: 100%;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            color: #5d3a1a;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        .sub {
            color: #7e5a3a;
            font-size: 1.1rem;
            margin-bottom: 25px;
            border-bottom: 2px dashed #c4a484;
            padding-bottom: 15px;
        }
        .emoji {
            font-size: 5rem;
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.2));
            margin-bottom: 10px;
        }
        .price-box {
            background: #f5e7d9;
            border-radius: 60px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-weight: 600;
            border: 1px solid #b99e7c;
        }
        .price-label { color: #5d3a1a; }
        .price-value { 
            background: #8b5a2b; 
            color: white; 
            padding: 8px 20px; 
            border-radius: 40px;
            font-size: 1.3rem;
        }
        .limit {
            background: #e8d9cc;
            border-radius: 40px;
            padding: 12px;
            margin-bottom: 25px;
            color: #2c1b0b;
            font-weight: 500;
        }
        .bonus {
            background: #d4b48c;
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 30px;
            font-weight: bold;
            color: #2c1b0b;
            border: 2px solid #a67c52;
        }
        .wallet-status {
            background: #d1e0d1;
            border-radius: 30px;
            padding: 10px 15px;
            margin-bottom: 25px;
            font-size: 0.95rem;
            word-break: break-word;
            border: 1px solid #6b8e6b;
        }
        button {
            background: #8b5a2b;
            color: white;
            border: none;
            border-radius: 60px;
            padding: 18px 30px;
            font-size: 1.3rem;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 8px 0 #5d3a1a;
            margin-bottom: 15px;
        }
        button:hover:not(:disabled) {
            background: #a6743c;
            transform: translateY(-2px);
            box-shadow: 0 10px 0 #5d3a1a;
        }
        button:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #5d3a1a;
        }
        button:disabled {
            background: #b3a18f;
            box-shadow: 0 8px 0 #7e6b59;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .info {
            color: #3d2b18;
            background: #f0e1d0;
            border-radius: 20px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.95rem;
            border: 1px solid #b99e7c;
        }
        .error {
            color: #a13d3d;
            background: #ffdddd;
            border-radius: 20px;
            padding: 12px;
            margin-top: 15px;
            border: 1px solid #ff8888;
        }
        a {
            color: #8b5a2b;
            font-weight: 600;
            text-decoration: none;
        }
        a:hover { text-decoration: underline; }
        .footer { margin-top: 25px; font-size: 0.85rem; color: #7a5d40; }
    </style>
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—ã–π CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.91.1/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metaplex-foundation/umi@0.9.1/dist/umi.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metaplex-foundation/umi-bundle-defaults@0.9.1/dist/umi-bundle-defaults.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metaplex-foundation/umi-signer-wallet-adapters@0.9.1/dist/umi-signer-wallet-adapters.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metaplex-foundation/mpl-candy-machine@6.0.1/dist/mpl-candy-machine.umd.min.js"></script>
</head>
<body>
    <div class="card">
        <h1>ü•ú WALNUT EMOTIONS</h1>
        <div class="sub">30 unique walnuts ¬∑ each with a feeling</div>
        <div class="emoji">üå∞‚ú®</div>

        <div class="price-box">
            <span class="price-label">üíé Mint price</span>
            <span class="price-value">0.1 SOL</span>
        </div>

        <div class="limit">
            ‚ö° Max 3 per wallet ¬∑ Bot tax 0.01 SOL
        </div>

        <div class="bonus">
            üéÅ <strong>BONUS:</strong> Mint 3 and get a <strong>GOLDEN WALNUT</strong> airdropped FREE!
        </div>

        <div class="wallet-status" id="walletStatus">
            üîò Wallet not connected
        </div>

        <button id="mintButton" disabled>üîå Connect Wallet</button>

        <div class="info" id="mintInfo">
            üïí Mint starts <strong>February 14, 2026 ¬∑ 22:00 UTC</strong><br>
            (check your local time)
        </div>

        <div class="footer">
            ‚ö° Powered by Solana ¬∑ Candy Machine v3<br>
            <a href="https://x.com/arturbarn?s=21" target="_blank">üê¶ Twitter</a>
        </div>
    </div>

    <script>
        (async function() {
            // ---------- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ----------
            const CANDY_MACHINE_ID = '4Z4VH9UVMSEHqZJRqutQcAStkiBXFKeeSdbr2DjKAy9o';
            const RPC_ENDPOINT = 'https://api.mainnet-beta.solana.com';
            // ----------------------------------

            // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
            await new Promise((resolve) => {
                const check = () => {
                    if (window.umiBundleDefaults && window.umi && window.umiSignerWalletAdapters && window.mplCandyMachine) {
                        resolve();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });

            // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            const mintButton = document.getElementById('mintButton');
            const walletStatus = document.getElementById('walletStatus');
            const mintInfo = document.getElementById('mintInfo');

            let umi = null;
            let candyMachine = null;
            let wallet = null;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Phantom
            const provider = window?.phantom?.solana;

            if (!provider?.isPhantom) {
                walletStatus.innerHTML = '‚ùå Phantom wallet not found. Please install <a href="https://phantom.app/" target="_blank">Phantom</a>.';
                mintButton.disabled = true;
                mintButton.innerText = 'Phantom required';
            } else {
                // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
                window.connectWallet = async function() {
                    try {
                        if (!provider.publicKey) {
                            await provider.connect();
                        }
                        const walletPublicKey = provider.publicKey.toString();
                        wallet = provider.publicKey;

                        // –°–æ–∑–¥–∞—ë–º UMI instance —Å –∞–¥–∞–ø—Ç–µ—Ä–æ–º
                        const umiInstance = umiBundleDefaults.createUmi(RPC_ENDPOINT)
                            .use(mplCandyMachine.mplCandyMachine());
                        
                        const walletAdapter = {
                            publicKey: provider.publicKey,
                            signMessage: provider.signMessage,
                            signTransaction: provider.signTransaction,
                            signAllTransactions: provider.signAllTransactions,
                        };
                        umi = umiInstance.use(umiSignerWalletAdapters.walletAdapterIdentity(walletAdapter));

                        walletStatus.innerHTML = `‚úÖ Connected: <strong>${walletPublicKey.slice(0,4)}...${walletPublicKey.slice(-4)}</strong>`;
                        mintButton.disabled = false;
                        mintButton.innerText = 'ü•ú Mint Random Walnut';

                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Candy Machine
                        try {
                            const candyMachinePublicKey = umi.publicKey(CANDY_MACHINE_ID);
                            candyMachine = await mplCandyMachine.fetchCandyMachine(umi, candyMachinePublicKey);
                            const itemsMinted = Number(candyMachine.itemsRedeemed);
                            const itemsAvailable = Number(candyMachine.data.itemsAvailable);
                            mintInfo.innerHTML = `üìä Minted: <strong>${itemsMinted} / ${itemsAvailable}</strong> ¬∑ Price: 0.1 SOL + fees`;
                        } catch (e) {
                            console.warn('Could not fetch candy machine stats', e);
                        }
                    } catch (err) {
                        console.error(err);
                        walletStatus.innerHTML = '‚ùå Connection failed. Please try again.';
                    }
                };

                // –§—É–Ω–∫—Ü–∏—è –º–∏–Ω—Ç–∞
                window.mintNft = async function() {
                    if (!umi || !wallet) {
                        await window.connectWallet();
                        if (!umi) return;
                    }

                    mintButton.disabled = true;
                    mintButton.innerText = '‚è≥ Minting...';
                    mintInfo.innerText = 'Processing transaction...';

                    try {
                        const candyMachinePublicKey = umi.publicKey(CANDY_MACHINE_ID);
                        
                        // –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ CM
                        candyMachine = await mplCandyMachine.fetchCandyMachine(umi, candyMachinePublicKey);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç
                        if (candyMachine.itemsRedeemed >= candyMachine.data.itemsAvailable) {
                            throw new Error('Collection sold out!');
                        }

                        // –ú–∏–Ω—Ç–∏–º
                        const mintBuilder = await mplCandyMachine.mintV2(umi, {
                            candyMachine: candyMachinePublicKey,
                            collectionMint: candyMachine.collectionMint,
                            collectionUpdateAuthority: candyMachine.authority,
                            mintArgs: {
                                solPayment: umi.some({}),
                                mintLimit: umi.some({ id: 1 }),
                                botTax: umi.some({ lamports: 10000000 }), // 0.01 SOL
                            }
                        }).buildAndSign(umi);

                        const signature = await umi.rpc.sendTransaction(mintBuilder, {
                            commitment: 'confirmed',
                        });

                        mintInfo.innerHTML = `‚úÖ Mint successful!<br>Signature: <a href="https://solscan.io/tx/${signature}" target="_blank">${signature.slice(0,8)}...${signature.slice(-8)}</a><br>‚è≥ It may take a moment to appear in your wallet.`;
                        
                        // –û–±–Ω–æ–≤–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        candyMachine = await mplCandyMachine.fetchCandyMachine(umi, candyMachinePublicKey);
                        const itemsMinted = Number(candyMachine.itemsRedeemed);
                        const itemsAvailable = Number(candyMachine.data.itemsAvailable);
                        mintInfo.innerHTML += `<br>üìä Minted: ${itemsMinted} / ${itemsAvailable}`;

                    } catch (err) {
                        console.error('Mint error:', err);
                        mintInfo.innerHTML = `‚ùå Error: ${err.message || 'Unknown error'}`;
                    } finally {
                        mintButton.disabled = false;
                        mintButton.innerText = 'ü•ú Mint Random Walnut';
                    }
                };

                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
                mintButton.addEventListener('click', async () => {
                    if (!umi) {
                        await window.connectWallet();
                    } else {
                        await window.mintNft();
                    }
                });

                // –ï—Å–ª–∏ –∫–æ—à–µ–ª—ë–∫ —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω (–ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)
                if (provider.publicKey) {
                    await window.connectWallet();
                }
            }
        })();
    </script>
</body>
</html>
